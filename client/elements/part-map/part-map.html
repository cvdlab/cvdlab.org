
<template-element id="part-map">
  <template>
    <style>
      :host {
        display: block;
      }

      [ref="container"] {
        height: 400px;
      }
    </style>

    <div>
      <div ref="container"></div>
    </div>
  </template>
</template-element>

<script>
  class PartMap extends Pantarei.Element {

    static get is () { return 'part-map' }

    get properties () {
      return {
        latitude: {
          value: -34.397
        },
        longitude: {
          value: 150.644
        },
        zoom: {
          value: 8
        }
      }
    }

    after_connect () {
      this.load_api()
    }

    load_api () {
      var callback_name = '__google_maps_callback'
      if (window[callback_name]) {
        this.on_load_api()
        return
      }
      window[callback_name] = this.on_load_api.bind(this)
      var script = document.createElement('script')
      script.async = true
      script.defer = true
      script.src = 'https://maps.googleapis.com/maps/api/js?callback=' + callback_name
      document.body.appendChild(script)
    }

    on_load_api () {
      this.latlng = { lat: 41.85546049999999, lng: 12.471896199999936 }
      this.map = new google.maps.Map(this.refs.container, { center: this.latlng, zoom: 15 })
      this.marker = new google.maps.Marker({ position: this.latlng, map: this.map })
    }

  }

  document.registerElement('part-map', PartMap)
</script>