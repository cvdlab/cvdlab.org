var Pantarei;!function(){Pantarei={},Pantarei.templates={};class t extends HTMLElement{get ATTRIBUTE_EVENT_PREFIX(){return"on-"}get EXPRESSION_BEGIN(){return"{{"}get EXPRESSION_END(){return"}}"}get props(){return{}}setup(){this._parse()}_listener(t){let e=this.shadowRoot,i=t.target,n=t.type,s=this.ATTRIBUTE_EVENT_PREFIX+n,o=!0,r=t.stopPropagation;for(t.stopPropagation=function(){r.call(t),o=!1};o;){let n=i.getAttribute(s);if(n){let e=this[n];e.call(this,t,t.detail)}if(!o)break;if(i=i.parentNode,!i)break;if(i===e)break}}_is_expression(t){return t.startsWith(this.EXPRESSION_BEGIN)&&t.endsWith(this.EXPRESSION_END)}_is_event(t){return t.startsWith(this.ATTRIBUTE_EVENT_PREFIX)}_parse_event(t){return t.slice(this.ATTRIBUTE_EVENT_PREFIX.length)}_parse(){this._listeners={};let t=this.shadowRoot,e=t.firstChild;for(;e;)this._parse_node(e),e=e.nextSibling}_parse_node(t){t._container=this;let e=t.nodeType;return e===t.TEXT_NODE?void this._parse_node_text(t):e===t.DOCUMENT_FRAGMENT_NODE?void this._parse_node_fragment(t):e===t.ELEMENT_NODE?void this._parse_node_element(t):void 0}_parse_node_text(t){let e=t.textContent.trim();if(""!==e&&this._is_expression(e)){let i=document.createElement("template-text");i._container=this,i.setAttribute("text",e),this._parse_node(i),t.parentNode.insertBefore(i,t),t.remove()}}_parse_node_fragment(t){let e=t.firstChild;for(;e;)this._parse_node(e),e=e.nextSibling}_parse_node_element(t){t._directives={},this._parse_node_attributes(t);let e=t.firstChild;for(;e;)this._parse_node(e),e=e.nextSibling}_parse_node_attributes(t){let e=t.attributes,i=e.length;for(let n=0;n<i;n++){let i=e[n],s=i.name,o=i.value;if(this._is_expression(o)){let e=this._parse_expression(o),i=function(t){this[s]=e(t)};t._directives[s]=i}else if(this._is_event(s)){let t=this._parse_event(s);this._listeners[t]||(this._listeners[t]=!0,this.shadowRoot.addEventListener(t,this._listener,!1))}}}_parse_expression(t){let e=t.length,i=this.EXPRESSION_BEGIN.length,n=e-this.EXPRESSION_END.length,s=t.substring(i,n),o=s.split("."),r=o.length;return 1==r?function(t){return t[s]}:function(t){for(let e=0;e<r&&t;e++){let i=o[e];t=t[i]}return t}}set_props(t){for(let e in t){let i=t[e],n=i.value;this.hasAttribute(e)&&(n=this.getAttribute(e)),void 0!==n&&(this[e]=n)}}render(t){this._render_node_children(this.shadowRoot,t)}_render_node_children(t,e){let i=t.firstElementChild;for(;i;)this._render_node(i,e),i=i.nextElementSibling}_render_node(t,e){if(e=e||this,t.nodeType===t.ELEMENT_NODE){let i=t._directives;if(i)for(let n in i){let s=i[n];s.call(t,e)}this._render_node_children(t,e),t.render&&t.render(e)}}_cache_refs(){let t={},e=this.shadowRoot.querySelectorAll("[ref]");for(let i=0,n=e.length;i<n;i++){let n=e[i],s=n.getAttribute("ref");n.ref=s,t[s]=n}this.refs=t}should_update(){return!0}update(){let t=this.should_update();t&&this.render()}fire(t,e){let i={bubbles:!0,cancelable:!0,detail:e},n=new CustomEvent(t,i);return this.dispatchEvent(n),this}action(t,e){return this.fire("action",{name:t,data:e}),this}async(t){requestAnimationFrame(t.bind(this))}createdCallback(){this._listener=this._listener.bind(this),this.createShadowRoot();let t=this.localName,e=Pantarei.templates[t],i=e.content,n=document.importNode(i,!0);this.shadowRoot.appendChild(n),this.set_props(this.props),this.setup(),this._cache_refs(),this.after_create(),"undefined"!=typeof ShadyCSS&&ShadyCSS.applyStyle(this,this.shadowRoot)}attachedCallback(){this.update()}after_create(){}detachedCallback(){}connectedCallback(){}disconnectedCallback(){}attributeChangedCallback(){}}Pantarei.Element=t;class e extends HTMLElement{createdCallback(){let t=this.id,e=this.querySelector("template");e=document.importNode(e,!0),Pantarei.templates[t]=e,"undefined"!=typeof ShadyCSS&&ShadyCSS.prepareTemplate(e,t),console.log("created",t)}}document.registerElement("template-element",e),Pantarei.TemplateElement=e;class i extends HTMLElement{createdCallback(){let t=this.querySelector("template");this._template=document.importNode(t,!0),this.stage=document.createDocumentFragment()}attachedCallback(){this._setup()}_setup(){let t=this._template,e=t.content,i=e.children[0];this.stage.appendChild(i),this._node=i.cloneNode(!0),e.appendChild(i),this._item_name=this.getAttribute("item")||"item",this._index_name=this.getAttribute("index")||"index",this._items=[],this._clones=[]}_create_clone(t){let e=this._node.cloneNode(!0);this.parentNode.insertBefore(e,this),this._container._parse_node(e),this._clones[t]=e}_render_clone(t,e){let i=this._clones[t],n=Object.assign({},e),s=this.items[t];n[this._item_name]=s,n[this._index_name]=t,this._container._render_node(i,n)}_remove_clone(t){let e=this._clones[t];e.remove(),this._clones[t]=null}render(t){let e=this._items||[],i=this.items;Array.isArray(i)||(i=[]),this.items=i.slice();let n=e.length,s=i.length;if(s<n){for(let e=0;e<s;e++)this._render_clone(e,t);for(let e=s;e<n;e++)this._remove_clone(e)}else{for(let e=0;e<n;e++)this._render_clone(e,t);for(let e=n;e<s;e++)this._create_clone(e),this._render_clone(e,t)}this._items=this.items}}document.registerElement("template-repeat",i),Pantarei.TemplateRepeat=i;class n extends HTMLElement{createdCallback(){let t=this.querySelector("template");this._template=document.importNode(t,!0),this.stage=document.createDocumentFragment()}attachedCallback(){this._setup()}_setup(){let t=this._template,e=t.content,i=e.children[0];this.stage.appendChild(i),this._node=i.cloneNode(!0),e.appendChild(i),this._clone=null}_create_clone(){let t=this._node.cloneNode(!0);this._container.parse_node(t),this.parentNode.insertBefore(t,this),this._clone=t}_render_clone(){}_remove_clone(){this._clone.remove(),this._clone=null}render(){let t=this._test,e=this.test;e?t?this._render_clone():(this._create_clone(),this._render_clone()):t&&this._remove_clone()}}document.registerElement("template-if",n),Pantarei.TemplateIf=n;class s extends HTMLElement{createdCallback(){this.style.display="none"}attachedCallback(){this._setup()}_setup(){this._node=document.createTextNode(""),this.parentNode.insertBefore(this._node,this);let t=function(t){this._node.textContent=this.text};this.directive=t}render(t){this.directive&&this.directive.call(this,t)}}document.registerElement("template-text",s),Pantarei.TemplateText=s}();