<template-element id="part-header">
  <template>
    <style>
      :host {
        display: block;
      }

      #header {
        width: 100%;
        height: 70px;
        box-sizing: border-box;
      }

      #navbar {
        box-sizing: border-box;
        @apply --layout-horizontal;
      }

      #navbar .space {
        @apply --layout-flex;
      }

      #brand {
        font-weight: 600;
      }

      #brand,
      #navbar #links {
        @apply --layout-horizontal;
        @apply --layout-no-wrap;
      }

      #navbar #brand .link,
      #navbar #links .link {
        @apply --layout;
        @apply --layout-center;
        padding: 0 20px;
        font-size: 12px;
        font-weight: 600;
        -webkit-font-smoothing: antialiased;
        letter-spacing: 1px;
        text-transform: uppercase;
      }
      #navbar #links {
        margin-right: -20px;
      }

      #navbar #brand .link a,
      #navbar #links .link a {
        text-decoration: none;
        color: #333;
        transition-property: color;
        transition-duration: .5s;
      }
      #navbar #brand .link a {
        font-weight: 600;
        /*color: rgb(180, 50, 50);*/
      }

      #navbar #brand .link,
      #navbar #links .link:first-child {
        padding-left: 0;
      }
      #navbar #brand .link,
      #navbar #links .link:last-child {
        padding-right: 0;
      }

      #navbar #links.collapse .link {
        font-size: 28px;
      }

      #navbar #menu {
        @apply --layout-box;
        @apply --layout-vertical;
        position: absolute;
        top: 70px;
        left: 0;
        width: 100%;
        height: 100vh;
        padding: 0 5%;
        background-color: white;
      }
      #navbar #menu .item a {
        display: inline-block;
        width: 100%;
        font-size: 12px;
        font-weight: 600;
        -webkit-font-smoothing: antialiased;
        letter-spacing: .75px;
        text-transform: uppercase;
        padding: 20px 0px;
      }
      #navbar #menu .item.space {
        @apply --layout-flex;
      }

      #navbar #links .link a,
      #navbar #menu .item a,
      #navbar #toggle {
        text-decoration: none;
        color: #333;
      }
      #navbar #links .link:hover a,
      #navbar #menu .item:hover a {
        color: rgb(180, 50, 50);
      }
      #navbar #links .link.selected a,
      #navbar #links .item.selected a {
        font-weight: 600;
        color: rgb(180, 50, 50);
      }

      #navbar #toggle {
        position: absolute;
        right: 0;
        box-sizing: border-box;
        width: 20%;
        height: 60px;
        text-align: right;
        padding: 8px 20px;
        font-size: 30px
      }

      #navbar #menu {
        display: none;
      }
      @media (max-width: 768px) {
        #header.open #menu {
          display: flex;
        }
      }

      #navbar #toggle {
        display: none;
      }
      @media (max-width: 768px) {
        #navbar #brand .link {
          font-weight: 600;
        }
        #navbar #links .link {
          display: none;
        }
        #navbar #toggle {
          display: block;
        }
        #topbar .contact .label {
          display: none;
        }
      }

      :host-context([transparent="true"]) #navbar {
        background-color: transparent;
        box-shadow: none;
      }

      :host-context([transparent="true"]) #navbar #brand .link a,
      :host-context([transparent="true"]) #navbar #links .link a {
        color: white;
        font-weight: 600;
      }

      @media (max-width: 768px) {
        :host-context([transparent="true"]) #navbar {
          background-color: white;
        }
        :host-context([transparent="true"]) #navbar #brand .link a,
        :host-context([transparent="true"]) #navbar #links .link a {
          color: #333;
        }
      }
    </style>

    <div id="header">
      <div id="navbar">
        <div id="brand">
          <app-link class="link">
            <a href="/">{{brand}}</a>
          </app-link>
        </div>
        <div class="space"></div>
        <div id="links">
          <x-repeat id="repeat_links" items="{{links}}">
            <template>
              <app-link class="link">
                <a href="{{item.link}}">{{item.label}}</a>
              </app-link>
            </template>
          </x-repeat>
          <a id="toggle" href="#">â˜°</a>
        </div>
        <div id="menu">
          <x-repeat id="repeat_items" items="{{links}}">
            <template>
              <app-link class="item">
                <a href="{{item.link}}">{{item.label}}</a>
              </app-link>
            </template>
          </x-repeat>
          <div class="item space"></div>
        </div>
      </div>
    </div>

  </template>
</template-element>

<script>
  class PartHeader extends Pantarei.Element {

    static get is () {
      return 'part-header'
    }

    static get props () {
      return {
        brand: {
          type: String,
          value: ''
        },
        links: {
          type: Array,
          value: []
        }
      }
    }

    constructor () {
      super()
      this.on_render_link = this.on_render_link.bind(this)
      this.on_click_toggle = this.on_click_toggle.bind(this)
      this.on_click_menu = this.on_click_menu.bind(this)
    }

    ready () {
      this.refs.toggle.addEventListener('click', this.on_click_toggle)
      this.refs.menu.addEventListener('click', this.on_click_menu)
      this.refs.repeat_items.addEventListener('render', this.on_render_link)
      this.refs.repeat_links.addEventListener('render', this.on_render_link)
    }

    toggle () {
      this.refs.header.classList.toggle('open')
    }

    on_render_link (event) {
      let detail = event.detail
      let index = detail.index
      let node = detail.node

      node.classList.toggle('selected', index === this.selected)
    }

    on_click_toggle (event) {
      event.preventDefault()
      event.stopPropagation()
      this.toggle()
    }

    on_click_menu (event) {
      let target = event.target
      if (target.nodeName !== 'A') {
        return
      }
      this.toggle()
    }

  }

  customElements.define('part-header', PartHeader)
</script>
