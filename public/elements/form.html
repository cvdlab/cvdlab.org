<link rel="import" href="../bower_components/polymer/polymer.html">

<polymer-element name="polymer-form"  attributes="">
  <template>
    <link rel="stylesheet" href="../styles/bootstrap.min.css">
    <style>
      :host { 
        display: block;
      }

      #submit {
        margin-top: 36px;
        margin-bottom: 36px;
      };

      :host(.id-label) {
        margin-bottom: 36px;
      }

      /* 
      style if an ancestor has the different class
      :host(.different) { } 
      */
    </style>
    <template bind="{{ alumnus as alumnus }}">
      <div class="container">
        <h1 class="id-label"><span class="label label-default">{{ id }}</span></h1>
        <form role="form">
          <div class="form-group">
            <label for="full_name">Name Surname</label>
            <input type="text" class="form-control input-lg" id="full_name" name="full_name" placeholder="Enter your name and surname" value="{{ alumnus.full_name }}">
          </div>
          <div class="form-group">
            <label for="email">Email</label>
            <input type="email" class="form-control input-lg" id="email" name="email" placeholder="Enter your email address" value="{{ alumnus.email }}">
          </div>
          <div class="form-group">
            <label for="website">Personal website address [optional]</label>
            <input type="url" class="form-control input-lg" id="website" name="website" placeholder="Enter your personal website address, if any" value="{{ alumnus.website }}">
          </div>
          <div class="form-group">
            <label for="github_username">GitHub username</label>
            <input type="text" class="form-control input-lg" id="github_username" name="github_username" placeholder="Enter your GitHub username" value="{{ alumnus.github_username }}">
          </div>
          <div class="form-group">
            <label for="year">Year</label>
            <select class="form-control input-lg" id="year" name="year" value="{{ alumnus.year }}">
              <option value="">Select the year in which you take the course</option>
              <option value="2011" selected?="{{ alumnus.year == 2011 }}">2011</option>
              <option value="2012" selected?="{{ alumnus.year == 2012 }}">2012</option>
              <option value="2013" selected?="{{ alumnus.year == 2013 }}">2013</option>
              <option value="2014" selected?="{{ alumnus.year == 2014 }}">2014</option>
            </select>
          </div>
        </form>
        <button id="submit" on-click="{{ submit }}" class="btn btn-lg {{submit_button_type}} btn-block">{{ submit_text }}</button>
      </div>
    </template>
  </template>
  <script src="../bower_components/superagent/superagent.js"></script>
  <script>
    var qs = function (key) {  
      return unescape(window.location.search.replace(new RegExp("^(?:.*[&\\?]" + escape(key).replace(/[\.\+\*]/g, "\\$&") + "(?:\\=([^&]*))?)?.*$", "i"), "$1"));  
    }; 

    var request = superagent;
    var endpoint = '/alumni/';

    Polymer('polymer-form', {
      submit_text: 'Submit',
      submit_button_type: 'btn-primary',
      ready: function () {
        var id = +qs('id');
        var self = this;
        
        if (id) {
          endpoint += id;
        }

        request.get(endpoint, function (res) {
          self.alumnus = res.body;
        });

        this.id = id;
      },

      submit: function (e) {
        e.preventDefault();
        var self = this;
        var $ = this.$;

        var data = {
          full_name: this.alumnus.full_name,
          email: this.alumnus.email,
          website: this.alumnus.website,
          github_username: this.alumnus.github_username,
          year: +this.alumnus.year
        };

        request
          .post(endpoint)
          .send(data)
          .end(function (res) {
            self.submit_text = "Submitted :P thank you!";
            self.submit_button_type = "btn-success";
          });
        
      }
    });
  </script>
</polymer-element>
